<div class="grid">
    <div class="col-md-12"></div>

    <div class="card card-compact">
        <h5>Department</h5>
        <p-toolbar>
            <div class="p-toolbar-group-left">
                <button type="button" pButton pRipple icon="pi pi-plus" class="p-button-success mr-2" (click)="openAddDialog()" pTooltip="Add Department" tooltipPosition="bottom"></button>
                <button type="button" pButton pRipple icon="pi pi-trash" class="p-button-danger mr-2" (click)="departmentDelete()" pTooltip="Department Delete" tooltipPosition="bottom" [disabled]="!selectedDepartment"></button>
                <app-department-add #addDialog (saved)="onDepartmentSaved()"></app-department-add>
            </div>
            <div class="p-toolbar-group-right">
                <span class="p-input-icon-right">
                    <input #searchInput type="text" pInputText (input)="dt.filterGlobal(searchInput.value, 'contains')" placeholder="Search" />
                </span>
            </div>
        </p-toolbar>
        <p-toast />
        <p-table
            #dt
            [value]="departments"
            selectionMode="single"
            [(selection)]="selectedDepartment"
            [paginator]="true"
            [rows]="10"
            [rowsPerPageOptions]="[5, 10, 20, 50]"
            [globalFilterFields]="['isActive', 'departmentCode', 'departmentName']"
            dataKey="id"
            editMode="row"
            [tableStyle]="{ 'min-width': '50rem' }"
        >
            <ng-template #header>
                <tr>
                    <th style="width: 3rem">
                        <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                    </th>
                    <th pSortableColumn="departmentCode">Code<p-sortIcon field="departmentCode"></p-sortIcon></th>
                    <th pSortableColumn="departmentName">Name<p-sortIcon field="departmentName"></p-sortIcon></th>
                    <th pSortableColumn="isActive">Status<p-sortIcon field="isActive"></p-sortIcon></th>
                    <th></th>
                </tr>
            </ng-template>
            <ng-template #body let-department let-editing="editing" let-ri="rowIndex">
                <tr [pEditableRow]="department">
                    <td>
                        <p-tableCheckbox [value]="department"></p-tableCheckbox>
                    </td>
                    <td>
                        <p-cellEditor>
                            <ng-template #input>
                                <input pInputText type="text" [(ngModel)]="department.departmentCode" />
                            </ng-template>
                            <ng-template #output>
                                {{ department.departmentCode }}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td>
                        <p-cellEditor>
                            <ng-template #input>
                                <input pInputText type="text" [(ngModel)]="department.departmentName" required />
                            </ng-template>
                            <ng-template #output>
                                {{ department.departmentName }}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td>
                        <p-cellEditor>
                            <!-- Input (Edit Mode) -->
                            <ng-template pTemplate="input">
                                <p-dropdown appendTo="body" [options]="statusOptions" [(ngModel)]="department.isActive" optionLabel="label" optionValue="value" placeholder="Select Status"> </p-dropdown>
                            </ng-template>

                            <!-- Output (View Mode) -->
                            <ng-template pTemplate="output">
                                {{ department.isActive ? 'Active' : 'InActive' }}
                            </ng-template>
                        </p-cellEditor>
                    </td>

                    <td>
                        <div class="flex items-center justify-center gap-2">
                            <button *ngIf="!editing" pButton pRipple type="button" pInitEditableRow icon="pi pi-pencil" (click)="onRowEditInit(department)" text rounded severity="secondary"></button>
                            <button *ngIf="editing" pButton pRipple type="button" pSaveEditableRow icon="pi pi-check" (click)="onRowEditSave(department)" text rounded severity="secondary"></button>
                            <button *ngIf="editing" pButton pRipple type="button" pCancelEditableRow icon="pi pi-times" (click)="onRowEditCancel(department, ri)" text rounded severity="secondary"></button>
                        </div>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>
